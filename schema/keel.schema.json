{"$id":"https://keel-prestaging.us-west-2.spinnaker.mgmt.netflix.net/schema/","$root":"http://json-schema.org/draft-07/schema#","title":"DeliveryConfig","type":"object","properties":{"name":{"type":"string"},"application":{"type":"string"},"serviceAccount":{"type":"string"},"artifacts":{"type":"array","items":{"$ref":"#/$defs/DeliveryArtifact"},"uniqueItems":true},"environments":{"type":"array","items":{"$ref":"#/$defs/Environment"},"uniqueItems":true},"apiVersion":{"type":"string"}},"required":["name","application","serviceAccount"],"$defs":{"Action":{"type":"object","properties":{"type":{"type":"string"},"order":{"type":"number"},"targetGroupName":{"type":"string"},"redirectConfig":{"$ref":"#/$defs/RedirectConfig"}},"required":["type","order","targetGroupName"]},"ApplicationLoadBalancerSpec":{"type":"object","properties":{"moniker":{"$ref":"#/$defs/Moniker"},"locations":{"$ref":"#/$defs/SubnetAwareLocations"},"internal":{"type":"boolean"},"dependencies":{"$ref":"#/$defs/LoadBalancerDependencies"},"idleTimeout":{"type":"string","format":"duration"},"listeners":{"type":"array","items":{"$ref":"#/$defs/Listener"},"uniqueItems":true},"targetGroups":{"type":"array","items":{"$ref":"#/$defs/TargetGroup"},"uniqueItems":true},"overrides":{"type":"object"}},"required":["moniker","locations","listeners","targetGroups"]},"ArtifactImageProvider":{"type":"object","properties":{"deliveryArtifact":{"$ref":"#/$defs/DeliveryArtifact"},"artifactStatuses":{"type":"array","items":{"enum":["FINAL","CANDIDATE","SNAPSHOT","RELEASE"]}}},"required":["deliveryArtifact"]},"CanaryConstraint":{"type":"object","properties":{"timeout":{"type":"string","format":"duration"},"canaryConfigId":{"type":"string"},"beginAnalysisAfter":{"type":"string","format":"duration"},"canaryAnalysisInterval":{"type":"string","format":"duration"},"cleanupDelay":{"type":"string","format":"duration"},"lifetime":{"type":"string","format":"duration"},"metricsAccount":{"type":"string"},"storageAccount":{"type":"string"},"marginalScore":{"type":"number"},"passScore":{"type":"number"},"source":{"$ref":"#/$defs/CanarySource"},"regions":{"type":"array","items":{"type":"string"},"uniqueItems":true},"capacity":{"type":"number"},"failureCancelsRunningRegions":{"type":"boolean"},"minSuccessfulRegions":{"type":"number"}},"required":["canaryConfigId","lifetime","marginalScore","passScore","source","regions","capacity"]},"CanarySource":{"type":"object","properties":{"account":{"type":"string"},"cloudProvider":{"type":"string"},"cluster":{"type":"string"}},"required":["account","cloudProvider","cluster"]},"Capacity":{"type":"object","properties":{"min":{"type":"number"},"max":{"type":"number"},"desired":{"type":"number"}},"required":["min","max"]},"CidrRule":{"type":"object","properties":{"protocol":{"enum":["TCP","UDP","ICMP"]},"portRange":{"$ref":"#/$defs/PortRange"},"blockRange":{"type":"string"}},"required":["protocol","portRange","blockRange"]},"ClassicLoadBalancerHealthCheck":{"type":"object","properties":{"target":{"type":"string"},"interval":{"type":"string","format":"duration"},"healthyThreshold":{"type":"number"},"unhealthyThreshold":{"type":"number"},"timeout":{"type":"string","format":"duration"}},"required":["target"]},"ClassicLoadBalancerListener":{"type":"object","properties":{"internalProtocol":{"type":"string"},"internalPort":{"type":"number"},"externalProtocol":{"type":"string"},"externalPort":{"type":"number"},"sslCertificateId":{"type":"string"}},"required":["internalProtocol","internalPort","externalProtocol","externalPort"]},"ClassicLoadBalancerSpec":{"type":"object","properties":{"moniker":{"$ref":"#/$defs/Moniker"},"locations":{"$ref":"#/$defs/SubnetAwareLocations"},"internal":{"type":"boolean"},"dependencies":{"$ref":"#/$defs/LoadBalancerDependencies"},"idleTimeout":{"type":"string","format":"duration"},"listeners":{"type":"array","items":{"$ref":"#/$defs/ClassicLoadBalancerListener"},"uniqueItems":true},"healthCheck":{"$ref":"#/$defs/ClassicLoadBalancerHealthCheck"},"overrides":{"type":"object"}},"required":["moniker","locations","healthCheck"]},"ClusterDependencies":{"type":"object","properties":{"loadBalancerNames":{"type":"array","items":{"type":"string"},"uniqueItems":true},"securityGroupNames":{"type":"array","items":{"type":"string"},"uniqueItems":true},"targetGroups":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":[]},"ClusterDeployStrategy":{"oneOf":[{"$ref":"#/$defs/RedBlack"},{"$ref":"#/$defs/Highlander"}]},"ClusterSpec":{"type":"object","properties":{"moniker":{"$ref":"#/$defs/Moniker"},"imageProvider":{"$ref":"#/$defs/ImageProvider"},"deployWith":{"$ref":"#/$defs/ClusterDeployStrategy"},"locations":{"$ref":"#/$defs/SubnetAwareLocations"},"launchConfiguration":{"$ref":"#/$defs/LaunchConfigurationSpec"},"capacity":{"$ref":"#/$defs/Capacity"},"dependencies":{"$ref":"#/$defs/ClusterDependencies"},"health":{"$ref":"#/$defs/HealthSpec"},"scaling":{"$ref":"#/$defs/Scaling"},"tags":{"type":"object"},"overrides":{"type":"object"}},"required":["moniker","imageProvider","locations"]},"Condition":{"type":"object","properties":{"field":{"type":"string"},"values":{"type":"array","items":{"type":"string"}}},"required":["field","values"]},"Constraint":{"oneOf":[{"$ref":"#/$defs/DependsOnConstraint"},{"$ref":"#/$defs/TimeWindowConstraint"},{"$ref":"#/$defs/ManualJudgementConstraint"},{"$ref":"#/$defs/PipelineConstraint"},{"$ref":"#/$defs/CanaryConstraint"}]},"Constraints":{"type":"object","properties":{"hard":{"type":"object"},"soft":{"type":"object"}},"required":[]},"ContainerProvider":{"oneOf":[{"$ref":"#/$defs/ReferenceProvider"},{"$ref":"#/$defs/DigestProvider"},{"$ref":"#/$defs/VersionedTagProvider"}]},"CrossAccountReferenceRule":{"type":"object","properties":{"protocol":{"enum":["TCP","UDP","ICMP"]},"name":{"type":"string"},"account":{"type":"string"},"vpc":{"type":"string"},"portRange":{"$ref":"#/$defs/PortRange"}},"required":["protocol","name","account","vpc","portRange"]},"CustomizedMetricSpecification":{"type":"object","properties":{"name":{"type":"string"},"namespace":{"type":"string"},"statistic":{"type":"string"},"unit":{"type":"string"},"dimensions":{"type":"array","items":{"$ref":"#/$defs/MetricDimension"},"uniqueItems":true}},"required":["name","namespace","statistic"]},"DebianArtifact":{"type":"object","properties":{"name":{"type":"string"},"deliveryConfigName":{"type":"string"},"reference":{"type":"string"},"statuses":{"type":"array","items":{"enum":["FINAL","CANDIDATE","SNAPSHOT","RELEASE"]}},"versioningStrategy":{"$ref":"#/$defs/VersioningStrategy"}},"required":["name"]},"DebianSemVerVersioningStrategy":{"type":"object","properties":{},"required":[]},"DeliveryArtifact":{"oneOf":[{"$ref":"#/$defs/DebianArtifact"},{"$ref":"#/$defs/DockerArtifact"}]},"DependsOnConstraint":{"type":"object","properties":{"environment":{"type":"string"}},"required":["environment"]},"DigestProvider":{"type":"object","properties":{"organization":{"type":"string"},"image":{"type":"string"},"digest":{"type":"string"}},"required":["organization","image","digest"]},"DockerArtifact":{"type":"object","properties":{"name":{"type":"string"},"deliveryConfigName":{"type":"string"},"reference":{"type":"string"},"tagVersionStrategy":{"enum":["increasing-tag","semver-tag","branch-job-commit-by-job","semver-job-commit-by-job","semver-job-commit-by-semver"]},"captureGroupRegex":{"type":"string"},"versioningStrategy":{"$ref":"#/$defs/VersioningStrategy"}},"required":["name"]},"DockerVersioningStrategy":{"type":"object","properties":{"strategy":{"enum":["increasing-tag","semver-tag","branch-job-commit-by-job","semver-job-commit-by-job","semver-job-commit-by-semver"]},"captureGroupRegex":{"type":"string"}},"required":["strategy"]},"Environment":{"type":"object","properties":{"name":{"type":"string"},"resources":{"type":"array","items":{"$ref":"#/$defs/Resource"},"uniqueItems":true},"constraints":{"type":"array","items":{"$ref":"#/$defs/Constraint"},"uniqueItems":true},"notifications":{"type":"array","items":{"$ref":"#/$defs/NotificationConfig"},"uniqueItems":true}},"required":["name"]},"HealthSpec":{"type":"object","properties":{"cooldown":{"type":"string","format":"duration"},"warmup":{"type":"string","format":"duration"},"healthCheckType":{"enum":["EC2","ELB"]},"enabledMetrics":{"type":"array","items":{"enum":["GroupMinSize","GroupMaxSize","GroupDesiredCapacity","GroupInServiceInstances","GroupPendingInstances","GroupStandbyInstances","GroupTerminatingInstances","GroupTotalInstances"]},"uniqueItems":true},"terminationPolicies":{"type":"array","items":{"enum":["Default","OldestInstance","NewestInstance","OldestLaunchConfiguration","ClosestToNextInstanceHour"]},"uniqueItems":true}},"required":[]},"Highlander":{"type":"object","properties":{"strategy":{"enum":["highlander"]}},"required":["strategy"]},"ImageProvider":{"oneOf":[{"$ref":"#/$defs/ArtifactImageProvider"},{"$ref":"#/$defs/ReferenceArtifactImageProvider"},{"$ref":"#/$defs/JenkinsImageProvider"}]},"ImageSpec":{"type":"object","properties":{"artifactName":{"type":"string"},"baseLabel":{"enum":["RELEASE","CANDIDATE","PREVIOUS","UNSTABLE"]},"baseOs":{"type":"string"},"regions":{"type":"array","items":{"type":"string"},"uniqueItems":true},"storeType":{"enum":["EBS","S3","DOCKER"]},"artifactStatuses":{"type":"array","items":{"enum":["FINAL","CANDIDATE","SNAPSHOT","RELEASE"]}},"application":{"type":"string"}},"required":["artifactName","baseLabel","baseOs","regions","storeType","application"]},"JenkinsImageProvider":{"type":"object","properties":{"packageName":{"type":"string"},"buildHost":{"type":"string"},"buildName":{"type":"string"},"buildNumber":{"type":"string"}},"required":["packageName","buildHost","buildName","buildNumber"]},"LaunchConfigurationSpec":{"type":"object","properties":{"image":{"$ref":"#/$defs/VirtualMachineImage"},"instanceType":{"type":"string"},"ebsOptimized":{"type":"boolean"},"iamRole":{"type":"string"},"keyPair":{"type":"string"},"instanceMonitoring":{"type":"boolean"},"ramdiskId":{"type":"string"}},"required":[]},"Listener":{"type":"object","properties":{"port":{"type":"number"},"protocol":{"type":"string"},"certificateArn":{"type":"string"},"rules":{"type":"array","items":{"$ref":"#/$defs/Rule"},"uniqueItems":true},"defaultActions":{"type":"array","items":{"$ref":"#/$defs/Action"},"uniqueItems":true}},"required":["port","protocol"]},"LoadBalancerDependencies":{"type":"object","properties":{"securityGroupNames":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":[]},"ManualJudgementConstraint":{"type":"object","properties":{"timeout":{"type":"string","format":"duration"}},"required":[]},"MetricDimension":{"type":"object","properties":{"name":{"type":"string"},"value":{"type":"string"}},"required":["name","value"]},"MigrationPolicy":{"type":"object","properties":{"type":{"type":"string"}},"required":[]},"Moniker":{"type":"object","properties":{"app":{"type":"string"},"stack":{"type":"string"},"detail":{"type":"string"},"sequence":{"type":"number"}},"required":["app"]},"NotificationConfig":{"type":"object","properties":{"type":{"enum":["slack","email"]},"address":{"type":"string"},"frequency":{"enum":["verbose","normal","quiet"]}},"required":["type","address","frequency"]},"PipelineConstraint":{"type":"object","properties":{"timeout":{"type":"string","format":"duration"},"pipelineId":{"type":"string"},"retries":{"type":"number"},"parameters":{"type":"object"}},"required":["pipelineId"]},"PortRange":{"type":"object","properties":{"startPort":{"type":"number"},"endPort":{"type":"number"}},"required":["startPort","endPort"]},"PredefinedMetricSpecification":{"type":"object","properties":{"type":{"type":"string"},"label":{"type":"string"}},"required":["type"]},"RedBlack":{"type":"object","properties":{"strategy":{"enum":["red-black"]},"rollbackOnFailure":{"type":"boolean"},"resizePreviousToZero":{"type":"boolean"},"maxServerGroups":{"type":"number"},"delayBeforeDisable":{"type":"string","format":"duration"},"delayBeforeScaleDown":{"type":"string","format":"duration"},"stagger":{"type":"array","items":{"$ref":"#/$defs/StaggeredRegion"}}},"required":["strategy"]},"RedirectConfig":{"type":"object","properties":{"protocol":{"type":"string"},"port":{"type":"string"},"host":{"type":"string"},"path":{"type":"string"},"query":{"type":"string"},"statusCode":{"type":"string"}},"required":["protocol","host","path","statusCode"]},"ReferenceArtifactImageProvider":{"type":"object","properties":{"reference":{"type":"string"}},"required":["reference"]},"ReferenceProvider":{"type":"object","properties":{"reference":{"type":"string"}},"required":["reference"]},"ReferenceRule":{"type":"object","properties":{"protocol":{"enum":["TCP","UDP","ICMP"]},"name":{"type":"string"},"portRange":{"$ref":"#/$defs/PortRange"}},"required":["protocol","name","portRange"]},"Resource":{"type":"object","properties":{"apiVersion":{"type":"string"},"kind":{"type":"string"},"metadata":{"type":"object"},"spec":{"$ref":"#/$defs/ResourceSpec"}},"required":["apiVersion","kind","metadata","spec"]},"ResourceSpec":{"oneOf":[{"$ref":"#/$defs/ImageSpec"},{"$ref":"#/$defs/ClusterSpec"},{"$ref":"#/$defs/SecurityGroupSpec"},{"$ref":"#/$defs/ClassicLoadBalancerSpec"},{"$ref":"#/$defs/ApplicationLoadBalancerSpec"},{"$ref":"#/$defs/TitusClusterSpec"}]},"ResourcesSpec":{"type":"object","properties":{"cpu":{"type":"number"},"disk":{"type":"number"},"gpu":{"type":"number"},"memory":{"type":"number"},"networkMbps":{"type":"number"}},"required":[]},"Rule":{"type":"object","properties":{"priority":{"type":"string"},"conditions":{"type":"array","items":{"$ref":"#/$defs/Condition"}},"actions":{"type":"array","items":{"$ref":"#/$defs/Action"}},"default":{"type":"boolean"}},"required":["priority","actions","default"]},"Scaling":{"type":"object","properties":{"suspendedProcesses":{"type":"array","items":{"enum":["Launch","Terminate","AddToLoadBalancer","AlarmNotification","AZRebalance","HealthCheck","ReplaceUnhealthy","ScheduledActions"]},"uniqueItems":true},"targetTrackingPolicies":{"type":"array","items":{"$ref":"#/$defs/TargetTrackingPolicy"},"uniqueItems":true},"stepScalingPolicies":{"type":"array","items":{"$ref":"#/$defs/StepScalingPolicy"},"uniqueItems":true}},"required":[]},"SecurityGroupRule":{"oneOf":[{"$ref":"#/$defs/SelfReferenceRule"},{"$ref":"#/$defs/ReferenceRule"},{"$ref":"#/$defs/CrossAccountReferenceRule"},{"$ref":"#/$defs/CidrRule"}]},"SecurityGroupSpec":{"type":"object","properties":{"moniker":{"$ref":"#/$defs/Moniker"},"locations":{"$ref":"#/$defs/SimpleLocations"},"description":{"type":"string"},"inboundRules":{"type":"array","items":{"$ref":"#/$defs/SecurityGroupRule"},"uniqueItems":true},"overrides":{"type":"object"}},"required":["moniker","locations"]},"SelfReferenceRule":{"type":"object","properties":{"protocol":{"enum":["TCP","UDP","ICMP"]},"portRange":{"$ref":"#/$defs/PortRange"}},"required":["protocol","portRange"]},"SimpleLocations":{"type":"object","properties":{"account":{"type":"string"},"vpc":{"type":"string"},"regions":{"type":"array","items":{"$ref":"#/$defs/SimpleRegionSpec"},"uniqueItems":true}},"required":["account","regions"]},"SimpleRegionSpec":{"type":"object","properties":{"name":{"type":"string"}},"required":["name"]},"StaggeredRegion":{"type":"object","properties":{"region":{"type":"string"},"hours":{"type":"string"},"pauseTime":{"type":"string","format":"duration"}},"required":["region"]},"StepAdjustment":{"type":"object","properties":{"lowerBound":{"type":"number"},"upperBound":{"type":"number"},"scalingAdjustment":{"type":"number"}},"required":["scalingAdjustment"]},"StepScalingPolicy":{"type":"object","properties":{"name":{"type":"string"},"adjustmentType":{"type":"string"},"actionsEnabled":{"type":"boolean"},"comparisonOperator":{"type":"string"},"dimensions":{"type":"array","items":{"$ref":"#/$defs/MetricDimension"},"uniqueItems":true},"evaluationPeriods":{"type":"number"},"period":{"type":"string","format":"duration"},"threshold":{"type":"number"},"metricName":{"type":"string"},"namespace":{"type":"string"},"statistic":{"type":"string"},"warmup":{"type":"string","format":"duration"},"metricAggregationType":{"type":"string"},"stepAdjustments":{"type":"array","items":{"$ref":"#/$defs/StepAdjustment"},"uniqueItems":true}},"required":["adjustmentType","actionsEnabled","comparisonOperator","evaluationPeriods","period","threshold","metricName","namespace","statistic","stepAdjustments"]},"SubnetAwareLocations":{"type":"object","properties":{"account":{"type":"string"},"subnet":{"type":"string"},"vpc":{"type":"string"},"regions":{"type":"array","items":{"$ref":"#/$defs/SubnetAwareRegionSpec"},"uniqueItems":true}},"required":["account","regions"]},"SubnetAwareRegionSpec":{"type":"object","properties":{"name":{"type":"string"},"availabilityZones":{"type":"array","items":{"type":"string"},"uniqueItems":true}},"required":["name"]},"TargetGroup":{"type":"object","properties":{"name":{"type":"string"},"targetType":{"type":"string"},"protocol":{"type":"string"},"port":{"type":"number"},"healthCheckEnabled":{"type":"boolean"},"healthCheckTimeoutSeconds":{"type":"string","format":"duration"},"healthCheckPort":{"type":"number"},"healthCheckProtocol":{"type":"string"},"healthCheckHttpCode":{"type":"string"},"healthCheckPath":{"type":"string"},"healthCheckIntervalSeconds":{"type":"string","format":"duration"},"healthyThresholdCount":{"type":"number"},"unhealthyThresholdCount":{"type":"number"},"attributes":{"$ref":"#/$defs/TargetGroupAttributes"}},"required":["name","port"]},"TargetGroupAttributes":{"type":"object","properties":{"stickinessEnabled":{"type":"boolean"},"deregistrationDelay":{"type":"number"},"stickinessType":{"type":"string"},"stickinessDuration":{"type":"number"},"slowStartDurationSeconds":{"type":"number"},"properties":{"type":"object"}},"required":[]},"TargetTrackingPolicy":{"type":"object","properties":{"name":{"type":"string"},"warmup":{"type":"string","format":"duration"},"targetValue":{"type":"number"},"disableScaleIn":{"type":"boolean"},"predefinedMetricSpec":{"$ref":"#/$defs/PredefinedMetricSpecification"},"customMetricSpec":{"$ref":"#/$defs/CustomizedMetricSpecification"}},"required":["targetValue"]},"TimeWindow":{"type":"object","properties":{"days":{"type":"string"},"hours":{"type":"string"}},"required":[]},"TimeWindowConstraint":{"type":"object","properties":{"windows":{"type":"array","items":{"$ref":"#/$defs/TimeWindow"}},"tz":{"type":"string"}},"required":["windows"]},"TitusClusterSpec":{"type":"object","properties":{"moniker":{"$ref":"#/$defs/Moniker"},"deployWith":{"$ref":"#/$defs/ClusterDeployStrategy"},"locations":{"$ref":"#/$defs/SimpleLocations"},"container":{"$ref":"#/$defs/ContainerProvider"},"capacity":{"$ref":"#/$defs/Capacity"},"constraints":{"$ref":"#/$defs/Constraints"},"env":{"type":"object"},"containerAttributes":{"type":"object"},"resources":{"$ref":"#/$defs/ResourcesSpec"},"iamProfile":{"type":"string"},"entryPoint":{"type":"string"},"capacityGroup":{"type":"string"},"migrationPolicy":{"$ref":"#/$defs/MigrationPolicy"},"dependencies":{"$ref":"#/$defs/ClusterDependencies"},"tags":{"type":"object"},"overrides":{"type":"object"}},"required":["moniker","locations","container"]},"VersionedTagProvider":{"type":"object","properties":{"organization":{"type":"string"},"image":{"type":"string"},"tagVersionStrategy":{"enum":["increasing-tag","semver-tag","branch-job-commit-by-job","semver-job-commit-by-job","semver-job-commit-by-semver"]},"captureGroupRegex":{"type":"string"}},"required":["organization","image","tagVersionStrategy"]},"VersioningStrategy":{"oneOf":[{"$ref":"#/$defs/DebianSemVerVersioningStrategy"},{"$ref":"#/$defs/DockerVersioningStrategy"}]},"VirtualMachineImage":{"type":"object","properties":{"id":{"type":"string"},"appVersion":{"type":"string"},"baseImageVersion":{"type":"string"}},"required":["id","appVersion","baseImageVersion"]}}}
